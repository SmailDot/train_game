# ğŸš¨ è¨“ç·´å¤±æ•—æ—¥èªŒ

## ğŸ“… äº‹ä»¶æ™‚é–“ç·š

**ç™¼ç”Ÿæ™‚é–“**: 2025-11-14 æ™šä¸Š ~ 2025-11-15 æ—©ä¸Š
**ç™¼ç¾æ™‚é–“**: 2025-11-15 ä¸Šåˆ
**ç¸½æå¤±**: 7,028 æ¬¡è¿­ä»£ï¼ˆç´„ 3.5 å°æ™‚è¨“ç·´æ™‚é–“ï¼‰

---

## ğŸ” å•é¡Œæè¿°

### ç—‡ç‹€
- ç¡è¦ºå‰ï¼ˆè¿­ä»£ #5930ï¼‰ï¼šè¨“ç·´æ­£å¸¸ï¼Œæœ€é«˜åˆ† **1418**
- ç¡è¦ºå¾Œï¼ˆè¿­ä»£ #14460ï¼‰ï¼šé†’ä¾†ç™¼ç¾ç´„ **60,000 å±€éŠæˆ²å…¨éƒ¨å¾— 0/-1/-5 åˆ†**
- å´©æ½°æª¢æ¸¬å¤±æ•ˆï¼šç³»çµ±æŒçºŒè¨“ç·´ 7,028 æ¬¡è¿­ä»£æœªç™¼ç¾ç•°å¸¸

### è¡¨é¢å•é¡Œ
è¨“ç·´åœ¨è¿­ä»£ #7436 é™„è¿‘çªç„¶å´©æ½°ï¼Œä½†ç³»çµ±æœªæª¢æ¸¬åˆ°ä¸¦æŒçºŒè¨“ç·´åˆ° #14464ã€‚

---

## ğŸ› æ ¹æœ¬åŸå› åˆ†æ

### åŸå›  1: Scores.json TOP 50 æˆªæ–· Bug â­â­â­ï¼ˆè‡´å‘½ï¼‰

**ä½ç½®**: `game/ui.py` line 2199

```python
# éŒ¯èª¤çš„ä»£ç¢¼
self.leaderboard = sorted(
    self.leaderboard, key=lambda x: x["score"], reverse=True
)[:50]  # åªä¿ç•™å‰ 50 åï¼
```

**å½±éŸ¿**:
- `scores.json` åªä¿å­˜ TOP 50 é«˜åˆ†è¨˜éŒ„
- æ‰€æœ‰ 0 åˆ†è¨˜éŒ„è¢«ä¸Ÿæ£„
- å´©æ½°æª¢æ¸¬è®€å– `scores.json`ï¼Œåªçœ‹åˆ° 1000+ åˆ†çš„è¨˜éŒ„
- ç³»çµ±èª¤åˆ¤ï¼šã€Œä¸€åˆ‡æ­£å¸¸ã€

**æ•¸æ“šè­‰æ“š**:
```json
// scores.json å…§å®¹
[
  {"score": 1418, "iteration": 5936},  // æœ€é«˜åˆ†
  {"score": 1029, "iteration": 7436},  // æœ€å¾Œä¸€æ¬¡å¥½æˆç¸¾
  {"score": 1010, "iteration": ...}    // æœ€ä½åˆ†ä»æœ‰ 1010
]
// æ³¨æ„ï¼šæ²’æœ‰ä»»ä½• 0 åˆ†è¨˜éŒ„ï¼
```

### åŸå›  2: Critic Bias æ¥µåº¦ä¸ç©©å®š â­â­

**ç™¼ç¾æ–¹å¼**: åˆ†æ 171 å€‹æª¢æŸ¥é»ï¼ˆ#5940 â†’ #14460ï¼‰

**æ•¸æ“š**:
```
Critic.bias è®Šç•°ä¿‚æ•¸ï¼ˆCVï¼‰: 41.5%
å…¶ä»–åƒæ•¸ CV: < 3%
ç¸½è®ŠåŒ–: -44.7%
```

**å½±éŸ¿éˆ**:
```
Critic ä¸ç©©å®š
  â†“
Value ä¼°è¨ˆéŒ¯èª¤
  â†“
Advantage è¨ˆç®—éŒ¯èª¤
  â†“
Policy æ›´æ–°æ–¹å‘éŒ¯èª¤
  â†“
æ€§èƒ½å´©æ½°
```

### åŸå›  3: Actor Bias åœ¨å´©æ½°é»è·³è®Š â­

**æ•¸æ“š**:
```
å´©æ½°å‰ï¼ˆ#7390ï¼‰: 0.533719
å´©æ½°å¾Œï¼ˆ#7440ï¼‰: 0.560377
è®ŠåŒ–: +5.0%
```

**å½±éŸ¿**: å‹•ä½œåˆ†å¸ƒçªç„¶åç§»ï¼Œé¸æ“‡éŒ¯èª¤æ–¹å‘

### åŸå›  4: åƒæ•¸æŒçºŒå¢é•·ï¼ˆç¼ºä¹æ­£å‰‡åŒ–ï¼‰â­

**æ•¸æ“š**:
```
fc1.bias:     +11.2%
fc2.bias:     +10.9%
actor.weight: +13.5%
fc1.weight:   +8.6%
critic.weight: +5.4%
```

**åŸå› **: `weight_decay = 0`ï¼Œæ²’æœ‰æ¬Šé‡è¡°æ¸›

---

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### ä¿®å¾© 1: æ·»åŠ å®Œæ•´è¨“ç·´æ­·å² âœ…

**æ–‡ä»¶**: `game/ui.py` (line 2199 ä¹‹å¾Œ)

```python
# æ–°å¢ä»£ç¢¼ï¼šä¿å­˜å®Œæ•´æ­·å²
try:
    history_file = os.path.join("checkpoints", "training_history.json")
    history = []
    if os.path.exists(history_file):
        try:
            with open(history_file, "r", encoding="utf-8") as f:
                history = json.load(f)
        except:
            history = []
    
    # æ·»åŠ ç•¶å‰è¨˜éŒ„ï¼ˆåŒ…æ‹¬ 0 åˆ†ï¼ï¼‰
    history.append({
        "name": name,
        "score": score,
        "iteration": iteration_idx,
        "timestamp": None,
    })
    
    # åªä¿ç•™æœ€è¿‘ 1000 æ¢
    history = sorted(history, key=lambda x: x["iteration"], reverse=True)[:1000]
    
    with open(history_file, "w", encoding="utf-8") as f:
        json.dump(history, f, ensure_ascii=False, indent=2)
except Exception:
    pass
```

**æ•ˆæœ**: æ‰€æœ‰åˆ†æ•¸ï¼ˆåŒ…æ‹¬ 0 åˆ†ï¼‰éƒ½æœƒè¢«è¨˜éŒ„

### ä¿®å¾© 2: å´©æ½°æª¢æ¸¬å„ªå…ˆè®€å–å®Œæ•´æ­·å² âœ…

**æ–‡ä»¶**: `agents/pytorch_trainer.py` (lines 265-285)

```python
# ä¿®æ”¹ä»£ç¢¼ï¼šå„ªå…ˆè®€å–å®Œæ•´æ­·å²
scores_file = os.path.join(self.save_dir, "scores.json")
history_file = os.path.join(self.save_dir, "training_history.json")

# å„ªå…ˆç´šï¼štraining_history.json > scores.json
if os.path.exists(history_file):
    try:
        with open(history_file, "r", encoding="utf-8") as f:
            scores_data = json.load(f)
    except:
        # å¦‚æœ history æå£ï¼Œå›é€€åˆ° scores.json
        if not os.path.exists(scores_file):
            return False
        with open(scores_file, "r", encoding="utf-8") as f:
            scores_data = json.load(f)
elif os.path.exists(scores_file):
    with open(scores_file, "r", encoding="utf-8") as f:
        scores_data = json.load(f)
else:
    return False
```

**æ•ˆæœ**: å´©æ½°æª¢æ¸¬èƒ½çœ‹åˆ°æ‰€æœ‰åˆ†æ•¸ï¼ŒåŒ…æ‹¬ 0 åˆ†

### ä¿®å¾© 3: å„ªåŒ–è¶…åƒæ•¸ï¼ˆåŸºæ–¼åƒæ•¸åˆ†æï¼‰âœ…

**æ–‡ä»¶**: `utils/training_config.py`

| åƒæ•¸ | èˆŠå€¼ | æ–°å€¼ | åŸå›  |
|------|------|------|------|
| `lr` | 0.00025 | 0.0001 | æ¸›å°‘åƒæ•¸éœ‡ç›ª |
| `clip_eps` | 0.2 | 0.1 | é™åˆ¶ policy æ›´æ–°å¹…åº¦ |
| `vf_coef` | 0.5 | 1.0 | åŠ å¼· critic è¨“ç·´ |
| `ent_coef` | 0.01 | 0.02 | å¢åŠ æ¢ç´¢ |
| `max_grad_norm` | 0.5 | 0.3 | æ›´å¼·æ¢¯åº¦è£å‰ª |

**æ–‡ä»¶**: `agents/pytorch_trainer.py`

```python
# èˆŠä»£ç¢¼
self.opt = torch.optim.Adam(self.net.parameters(), lr=lr)

# æ–°ä»£ç¢¼
self.opt = torch.optim.Adam(self.net.parameters(), lr=lr, weight_decay=1e-4)
```

**æ•ˆæœ**: 
- Critic æ›´ç©©å®šï¼ˆé æœŸ CV å¾ 41.5% é™åˆ° <20%ï¼‰
- åƒæ•¸è®ŠåŒ–æ›´å¹³ç©©
- é˜²æ­¢æ¬Šé‡ç„¡é™å¢é•·

---

## ğŸ“Š åˆ†ææ•¸æ“š

### æª¢æŸ¥é»åˆ†æ
- **åˆ†æç¯„åœ**: #5940 â†’ #14460
- **æª¢æŸ¥é»æ•¸é‡**: 171 å€‹ï¼ˆæ¯ 50 æ¬¡è¿­ä»£æ¡æ¨£ï¼‰
- **è¿½è¹¤åƒæ•¸**: 8 å€‹æ ¸å¿ƒåƒæ•¸

### åƒæ•¸ç©©å®šæ€§æ’å
```
æœ€ä¸ç©©å®š â†’ æœ€ç©©å®š
1. critic.bias     CV: 41.5%  âš ï¸âš ï¸âš ï¸
2. actor.bias      CV: 19.3%  âš ï¸
3. fc1.bias        CV: 2.7%   âœ“
4. fc2.bias        CV: 2.4%   âœ“
5. actor.weight    CV: 1.9%   âœ“
6. fc1.weight      CV: 1.7%   âœ“
7. critic.weight   CV: 1.3%   âœ“
8. fc2.weight      CV: 0.7%   âœ“
```

### å´©æ½°å‰å¾Œåƒæ•¸è®ŠåŒ–
```
Top 3 è®ŠåŒ–æœ€å¤§çš„åƒæ•¸ï¼š
1. actor.bias:   +5.0%
2. critic.bias:  +1.3%
3. fc2.bias:     +0.6%
```

### å­¸ç¿’ç‡è®ŠåŒ–è¨˜éŒ„
```
è¿­ä»£ #5940:  LR = 0.00025000
è¿­ä»£ #6740:  LR = 0.00012500 (-50%)  âš ï¸
è¿­ä»£ #6840:  LR = 0.00025000 (+100%) âš ï¸
è¿­ä»£ #14440: LR = 0.00025000
```

**æ³¨æ„**: å­¸ç¿’ç‡åœ¨ #6740-#6840 æœŸé–“æœ‰ç•°å¸¸è·³è®Š

---

## ğŸ“ ç”Ÿæˆçš„åˆ†ææ–‡ä»¶

### åˆ†æå ±å‘Š
1. `checkpoints/param_trends.png` - åƒæ•¸è®ŠåŒ–è¶¨å‹¢åœ–
2. `checkpoints/detailed_parameter_analysis.json` - å®Œæ•´çµ±è¨ˆæ•¸æ“š
3. `checkpoints/parameter_analysis_report.json` - ç•°å¸¸æª¢æ¸¬å ±å‘Š
4. `PARAMETER_ANALYSIS_REPORT.md` - æ·±åº¦åˆ†æå ±å‘Š
5. `PARAMETER_IMPROVEMENT_GUIDE.md` - æ”¹é€²æ‡‰ç”¨æŒ‡å—
6. `QUICK_START.md` - å¿«é€ŸåŸ·è¡ŒæŒ‡å—

### é…ç½®æ–‡ä»¶
7. `training_config_improved.json` - æ”¹é€²å¾Œçš„é…ç½®
8. `checkpoints/training_config_suggestions.json` - é…ç½®å»ºè­°

### å‚™ä»½æ–‡ä»¶
9. `utils/training_config.py.backup_20251115_101144`
10. `agents/pytorch_trainer.py.backup_20251115_101144`

---

## ğŸ”„ å›æª”ç­–ç•¥

### é¸é … A: ä¿å®ˆå›æª”ï¼ˆæ¨è–¦ï¼‰âœ…
```
ç›®æ¨™: checkpoint_5930.pt
è¿­ä»£: #5936
åˆ†æ•¸: 1418ï¼ˆæ­·å²æœ€é«˜ï¼‰
é¢¨éšª: ä½
æå¤±: å›æª” 1,500 æ¬¡è¿­ä»£
```

### é¸é … B: æ¿€é€²å›æª”
```
ç›®æ¨™: checkpoint_7430.pt
è¿­ä»£: #7436
åˆ†æ•¸: 1029ï¼ˆæœ€å¾Œæ­£å¸¸ï¼‰
é¢¨éšª: ä¸­ï¼ˆæ¥è¿‘å´©æ½°é»ï¼‰
æå¤±: æœ€å°
```

### å¯¦éš›æ“ä½œ
```powershell
python execute_complete_fix.py
```

**åŸ·è¡Œå…§å®¹**:
1. å‚™ä»½ç•¶å‰ checkpoint_best.pt
2. è¤‡è£½ checkpoint_5930.pt â†’ checkpoint_best.pt
3. åˆªé™¤å´©æ½°å¾Œçš„æª¢æŸ¥é»ï¼ˆ#7500-#14464ï¼‰
4. æ›´æ–° training_meta.json
5. é‡‹æ”¾ç´„ 450 MB ç£ç¢Ÿç©ºé–“

---

## ğŸ“ˆ é æœŸæ”¹é€²æ•ˆæœ

### ç©©å®šæ€§æŒ‡æ¨™
```
ä¿®å¾©å‰ â†’ ä¿®å¾©å¾Œ
Critic bias CV:     41.5% â†’ <20%
åƒæ•¸è®ŠåŒ–å¹…åº¦:       >5%   â†’ <3%
å´©æ½°æª¢æ¸¬å»¶é²:       âˆ     â†’ 10-50 å±€
å´©æ½°æ¢å¾©æ™‚é–“:       æ‰‹å‹•  â†’ è‡ªå‹•
```

### è¨“ç·´æ•ˆæœ
```
âœ“ æ›´ç©©å®šçš„åˆ†æ•¸å¢é•·
âœ“ è‡ªå‹•å´©æ½°æª¢æ¸¬èˆ‡å›æª”
âœ“ å®Œæ•´çš„è¨“ç·´æ­·å²è¨˜éŒ„
âœ“ æ›´å¥½çš„æ¢ç´¢-åˆ©ç”¨å¹³è¡¡
âœ“ åƒæ•¸æ›´æ–°æ›´å¹³ç©©
```

---

## âœ… é©—è­‰æ¸…å–®

### ç«‹å³é©—è­‰ï¼ˆå‰ 100 æ¬¡è¿­ä»£ï¼‰
- [ ] è¨“ç·´æ­£å¸¸å•Ÿå‹•
- [ ] training_history.json é–‹å§‹å¡«å……
- [ ] åˆ†æ•¸ > 200
- [ ] ç„¡éŒ¯èª¤ä¿¡æ¯

### çŸ­æœŸé©—è­‰ï¼ˆå‰ 1000 æ¬¡è¿­ä»£ï¼‰
- [ ] åˆ†æ•¸ç©©å®šåœ¨ 500-1000
- [ ] æ²’æœ‰é€£çºŒ 10 å±€ < 200
- [ ] Critic bias CV < 30%
- [ ] å´©æ½°æª¢æ¸¬æœªè§¸ç™¼

### ä¸­æœŸé©—è­‰ï¼ˆå‰ 3000 æ¬¡è¿­ä»£ï¼‰
- [ ] åˆ†æ•¸æ¥è¿‘æˆ–è¶…é 1000
- [ ] Critic bias CV < 20%
- [ ] é”åˆ°æˆ–è¶…éæœ€é«˜åˆ† 1418

---

## ğŸ“ ç¶“é©—æ•™è¨“

### 1. æ°¸é ä¸è¦æˆªæ–·è¨“ç·´æ•¸æ“š
```
âŒ éŒ¯èª¤: åªä¿å­˜ TOP 50 åˆ†æ•¸
âœ… æ­£ç¢º: ä¿å­˜å®Œæ•´æ­·å²ï¼ˆæˆ–è‡³å°‘æœ€è¿‘ 1000 æ¢ï¼‰
```

### 2. ç›£æ§é—œéµæŒ‡æ¨™çš„ç©©å®šæ€§
```
âŒ éŒ¯èª¤: åªçœ‹æœ€çµ‚åˆ†æ•¸
âœ… æ­£ç¢º: ç›£æ§åƒæ•¸è®Šç•°ä¿‚æ•¸ï¼ˆCVï¼‰
```

### 3. ä½¿ç”¨æ¬Šé‡æ­£å‰‡åŒ–
```
âŒ éŒ¯èª¤: weight_decay = 0
âœ… æ­£ç¢º: weight_decay = 1e-4
```

### 4. Critic å’Œ Actor åŒç­‰é‡è¦
```
âŒ éŒ¯èª¤: vf_coef = 0.5ï¼ˆä½ä¼° criticï¼‰
âœ… æ­£ç¢º: vf_coef = 1.0ï¼ˆå¹³è¡¡è¨“ç·´ï¼‰
```

### 5. ä¿å®ˆçš„è¶…åƒæ•¸æ›´å®‰å…¨
```
âŒ éŒ¯èª¤: é«˜å­¸ç¿’ç‡ + å¤§ clip range
âœ… æ­£ç¢º: ä¸­ä½å­¸ç¿’ç‡ + å° clip range
```

---

## ğŸ“ å•é¡Œæ’æŸ¥æŒ‡å—

### å¦‚æœåˆ†æ•¸å†æ¬¡å´©æ½°

1. **æª¢æŸ¥ training_history.json**
   ```powershell
   python -c "import json; d=json.load(open('checkpoints/training_history.json')); print('Zero scores:', len([x for x in d if x['score']==0]))"
   ```

2. **æŸ¥çœ‹å´©æ½°æª¢æ¸¬æ—¥èªŒ**
   ```powershell
   # æ‡‰è©²çœ‹åˆ°è‡ªå‹•å›æª”ä¿¡æ¯
   ```

3. **é‡æ–°åˆ†æåƒæ•¸**
   ```powershell
   python analyze_parameter_trends.py
   ```

4. **æ›´ä¿å®ˆçš„é…ç½®**
   ```
   learning_rate: 0.0001 â†’ 0.00005
   clip_range: 0.1 â†’ 0.05
   ```

---

## ğŸ“Š çµ±è¨ˆç¸½çµ

```
å•é¡Œç™¼ç¾æ™‚é–“: 2025-11-15 ä¸Šåˆ
åˆ†ææ™‚é–“: ç´„ 2 å°æ™‚
ä¿®å¾©æ™‚é–“: ç´„ 30 åˆ†é˜
ç¸½æå¤±: 7,028 æ¬¡è¿­ä»£ + 3.5 å°æ™‚
æµªè²»ç©ºé–“: ~450 MBï¼ˆç„¡æ•ˆæª¢æŸ¥é»ï¼‰

ä¿®å¾©æªæ–½: 4 å€‹ä¸»è¦ä¿®æ”¹
ç”Ÿæˆæ–‡ä»¶: 10+ å€‹åˆ†ææ–‡ä»¶
å‚™ä»½æ–‡ä»¶: 2 å€‹
ä»£ç¢¼æ”¹å‹•: 3 å€‹æ–‡ä»¶

é æœŸæ¢å¾©æ™‚é–“: ç«‹å³ï¼ˆå›æª”å¾Œé‡å•Ÿè¨“ç·´ï¼‰
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•

```powershell
# 1. åŸ·è¡Œå›æª”ï¼ˆ2 åˆ†é˜ï¼‰
python execute_complete_fix.py

# 2. å•Ÿå‹•è¨“ç·´ï¼ˆä½¿ç”¨æ”¹é€²å¾Œçš„é…ç½®ï¼‰
python run_game.py

# 3. ç›£æ§ï¼ˆé¸æ“‡æ€§ï¼‰
tensorboard --logdir=checkpoints/tb
```

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2025-11-15 10:30:00
**ç‹€æ…‹**: âœ… æ‰€æœ‰ä¿®å¾©å·²å®Œæˆï¼Œç­‰å¾…å›æª”å’Œé‡å•Ÿè¨“ç·´
**ä¿¡å¿ƒç­‰ç´š**: â­â­â­â­â­ï¼ˆéå¸¸æœ‰ä¿¡å¿ƒï¼‰

ç¥è¨“ç·´é †åˆ©ï¼ä¸æœƒå†å´©æ½°äº†ï¼ğŸš€
