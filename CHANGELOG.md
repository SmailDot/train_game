# 更新日誌

## [2024-11-14] - 🌟 三指標追蹤系統 & BUG 修復

### 🐛 重大 BUG 修復
- **修復分數卡在 164 的問題**
  - 問題原因：速度增長過快（0.02/障礙物），導致在 32 個障礙物後速度增加 64%
  - 解決方案：降低 `ScrollIncreasePerPass` 從 0.02 改為 0.01
  - 新增勝利條件：達到 **99999 分即通關** 🎉

### ✨ 三指標追蹤系統（正反教材學習）
實現完整的智能訓練監控系統，從高分和低分雙向學習：

#### 核心功能
- ✅ **從高分學習成功經驗**
  - 追蹤 `max_reward`（最高單回合分數）
  - 發現新高峰時減少 patience -5
  - 延緩學習率降低，鼓勵探索

- ✅ **從低分識別失敗場景**
  - 追蹤 `min_reward`（最低單回合分數）
  - 最低分提升時減少 patience -3（穩定性改善）
  - 最低分惡化時增加 patience +2（警告信號）

- ✅ **平衡潛力與穩定性**
  - 同時評估平均、最高、最低三個指標
  - 平均分提升完全重置 patience
  - 動態調整學習率策略

- ✅ **自動適應訓練狀態**
  - 實時計算三指標並立即響應
  - 記錄到 TensorBoard 供分析
  - 控制台顯示詳細診斷信息

#### 技術實現
- `agents/pytorch_trainer.py`：
  - 新增 `best_min_reward` 追蹤變量
  - 更新 `_update_lr_adaptive()` 接受三個指標
  - 實現最低分惡化檢測（-5% 觸發警告）
  - TensorBoard 記錄 `reward/mean`、`reward/max`、`reward/min`

#### 訓練輸出改進
```
🎮 訓練效果:
  平均獎勵: 59.00
  最高獎勵: 170.00  ← 正面教材
  最低獎勵: -30.00  ← 反面教材

⚠️ 最低分惡化: -30.00（增加2次patience，策略不穩定）
🌟 新最高單回合分數: 170.00（減少5次patience）
⬆️ 最低分提升: 20.00（減少3次patience，穩定性改善）
```

### 🎯 勝利條件
- 遊戲達到 99999 分時自動結束並標記為通關
- 給予 +1000 巨大獎勵
- 排行榜顯示 "🎉 通關！" 標記
- AI 和人類模式都支持

### 📚 新增文檔
- `PEAK_TRACKING_FEATURE.md`：三指標系統完整技術文檔
- `三指標系統使用指南.md`：實用操作指南和問題排查

### 技術細節
- 環境：`game/environment.py`
  - 新增 `WinningScore = 99999` 常量
  - 降低速度增長率避免過快
  - 勝利檢測邏輯

- UI：`game/ui.py`
  - 勝利狀態顯示
  - 排行榜標記通關記錄

---

## [2024-01-XX] - UI 重構與訓練視覺化優化

### 新增功能
- **獨立訓練視覺化視窗** (`game/training_window.py`)
  - 800x600 獨立 Pygame 視窗
  - 真實神經網路結構視覺化（節點 + 連接線）
  - 科技感藍紫漸變色設計
  - 多序列 Loss Function 即時圖表
  - 線程安全的數據更新機制
  - AI 模式啟動時自動開啟

### 改進
- **UI 界面簡化**
  - 遊玩區域擴大：75% → 85%（更寬敞的視野）
  - 側邊面板簡化：只顯示模式、分數、排行榜
  - 移除擁擠的 NN 熱力圖和 Loss 圖表（改為獨立視窗顯示）
  - 按鈕文字置中、圓角設計
  
- **獎勵機制優化**
  - 移除時間懲罰：從 -0.1 改為 0.0
  - 讓分數更直觀，往前走不再扣分

### 技術改進
- TrainingWindow 使用獨立線程運行，避免阻塞主遊戲循環
- 自動在返回選單或退出時清理訓練視窗資源
- 保留向後兼容的 loss_history 數據結構

### 刪除
- 移除舊的 NN 權重熱力圖顯示代碼（約115行）
- 移除側邊面板的 Loss 圖表顯示

---

## [2024-01-XX] - 中文字體修復

### 修復
- 解決中文顯示為口口口口的問題
- 使用系統支援中文的字體（Microsoft JhengHei、Microsoft YaHei、SimHei）

---

## [2024-01-XX] - UI 全面優化

### 新增功能
- Game Over 對話框（繼續/返回選單）
- ESC 暫停功能
- 排行榜自動刷新和持久化
- 全面中文化界面

### 改進
- 修復右側面板重疊問題
- 優化按鈕佈局和間距
- 改進暫停選單 UI

---

## [2024-01-XX] - 滾動式障礙物系統

### 新增功能
- 多障礙物連續滾動系統
- 障礙物間距可配置（預設250像素）
- 自動生成和回收機制

### 改進
- 從單一障礙物改為連續滾動
- 提高遊戲流暢度和挑戰性

---

## [初始版本] - 專案建立

### 新增功能
- Flappy-like 遊戲環境
- PPO Agent 實作
- PyTorch Trainer
- Pygame UI 基礎框架
- 測試套件
